<!DOCTYPE html>
<html>
    <head>
        <title>WebAssembly Compute Test</title>
        <script>
        (async ()=>{
            
            let compute = await import("./compute/index.js");
            let request = await fetch("./assembly/test.wasm");
            //let code = await fetch("./assembly/allocator.wasm");

            // 
            let device = new compute.device({
                threadCount: 6,
                maxMemory: 65536*2
            });

            //
            //device.allocator(await compute.wasmModule(device, code));

            // 
            let kernel = new compute.program({
                assemblyCode: await request.arrayBuffer()
            });

            // 
            let ptr = device.mem(64);
            //let ptr = device.allocate({ byteSize: 12*8 });

            // map into specific address
            let map = ptr.u64();
            for (let i=0;i<12;i++) {
                map.idx(i).value = BigInt(i * 4);
            };

            // 
            let results = await device.execute(kernel, "threaded", [ptr.address()]);
            console.log(results.thread(5).u32().get(0));

        })();
        </script>
    </head>
    <body>
        
    </body>
</html>
